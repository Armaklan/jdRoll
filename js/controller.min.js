var selected=[];tinymce.init(-1!=navigator.userAgent.indexOf("IE")?{selector:".wysiwyg",plugins:["link image lists preview hr insertdatetime","table template textcolor fullscreen","emoticons code spellchecker"],browser_spellcheck:!0,convert_urls:!1,spellchecker_languages:"+French=fr",spellchecker_rpc_url:"{{app.request.baseUrl}}/tinymce/plugins/spellchecker/rpc.php",toolbar:"cut copy paste | styleselect removeformat | bold italic forecolor | alignleft aligncenter alignright alignjustify | hr | bullist numlist outdent indent | link image | preview fullscreen | emoticons private hide",style_formats:[{title:"Dialogue",inline:"span",classes:"dialogue",styles:{color:"#4488CC"}},{title:"Pensée",inline:"span",classes:"pensee",styles:{color:"#8844CC"}},{title:"Hrp",inline:"span",classes:"hrp",styles:{color:"grey"}},{title:"Titre 1",block:"h1"},{title:"Titre 2",block:"h2"},{title:"Titre 3",block:"h3"}],autosave_ask_before_unload:!1,setup:function(a){a.addButton("private",{text:"Prv",icon:!1,onclick:function(){a.windowManager.open({title:"Message privée",body:[{type:"listbox",name:"users",multiple:"true",size:"large",width:"200",values:specificValue,onselect:function(a){-1==selected.indexOf(a.control.value())?selected.push(a.control.value()):selected.splice(a.control.value())}}],onsubmit:function(){var b=tinyMCE.activeEditor.selection.getContent();a.insertContent("[private="+selected.join()+"]"+b+"[/private]")}})}}),a.addButton("hide",{text:"Hid",icon:!1,onclick:function(){var b=tinyMCE.activeEditor.selection.getContent();a.insertContent("[hide]"+b+"[/hide]")}})},min_height:160}:window.matchMedia("(min-width: 600px)").matches?{selector:".wysiwyg",plugins:["link image lists preview hr insertdatetime","table template textcolor fullscreen","emoticons code spellchecker"],browser_spellcheck:!0,convert_urls:!1,spellchecker_languages:"+French=fr",spellchecker_rpc_url:"{{app.request.baseUrl}}/tinymce/plugins/spellchecker/rpc.php",toolbar:"cut copy paste | styleselect removeformat | bold italic forecolor | alignleft aligncenter alignright alignjustify | hr | bullist numlist outdent indent | link image | preview fullscreen | emoticons private hide",style_formats:[{title:"Dialogue",inline:"span",classes:"dialogue",styles:{color:"#4488CC"}},{title:"Pensée",inline:"span",classes:"pensee",styles:{color:"#8844CC"}},{title:"Hrp",inline:"span",classes:"hrp",styles:{color:"grey"}},{title:"Titre 1",block:"h1"},{title:"Titre 2",block:"h2"},{title:"Titre 3",block:"h3"}],autosave_ask_before_unload:!1,setup:function(a){a.addButton("private",{text:"Prv",icon:!1,onclick:function(){a.windowManager.open({title:"Message privée",body:[{type:"listbox",name:"users",multiple:"true",size:"large",width:"200",values:specificValue,onselect:function(a){-1==selected.indexOf(a.control.value())?selected.push(a.control.value()):selected.splice(a.control.value())}}],onsubmit:function(){var b=tinyMCE.activeEditor.selection.getContent();a.insertContent("[private="+selected.join()+"]"+b+"[/private]")}})}}),a.addButton("hide",{text:"Hid",icon:!1,onclick:function(){var b=tinyMCE.activeEditor.selection.getContent();a.insertContent("[hide]"+b+"[/hide]")}})},min_height:160}:{selector:".wysiwyg",plugins:["link image lists preview hr insertdatetime","table template textcolor fullscreen","emoticons code"],menubar:!1,browser_spellcheck:!0,convert_urls:!1,toolbar:"paste | styleselect removeformat | bold italic | hr | link image | code",style_formats:[{title:"Dialogue",inline:"span",classes:"dialogue",styles:{color:"#4488CC"}},{title:"Pensée",inline:"span",classes:"pensee",styles:{color:"#8844CC"}},{title:"Hrp",inline:"span",classes:"hrp",styles:{color:"grey"}},{title:"Titre 1",block:"h1"},{title:"Titre 2",block:"h2"},{title:"Titre 3",block:"h3"}],autosave_ask_before_unload:!1,min_height:160,width:300});var onLoadControllerImpl=function(){function a(a){a.forEach(function(a){a()})}var b=[],c=[],d=[];return{generals:b,campagnes:c,withChats:d,onLoadGenerals:function(){a(b)},onLoadChat:function(){a(d)},onLoadCampagnes:function(){a(c)}}},onLoadController=onLoadControllerImpl(),campagneControllerImpl=function(){function a(a){0!=CAMPAGNE_ID&&$.ajax({type:"POST",url:BASE_PATH+"/campagne/admin_open",data:{id:CAMPAGNE_ID,state:a},success:function(){},error:function(){}})}function b(a,b){$.ajax({type:"POST",url:BASE_PATH+"/campagne/favoris",data:{campagne:a,statut:b},success:function(){},error:function(){}})}return{onAdminOpenChanged:function(){$("#admMode").click(function(){$("#admMode").hasClass("admDisabled")?($("#admMode").removeClass("admDisabled"),$(".admIcone").removeClass("invisible"),$("#admMode i").removeClass("icon-eye-open"),$("#admMode i").addClass("icon-eye-close"),a(1)):($("#admMode").addClass("admDisabled"),$(".admIcone").addClass("invisible"),$("#admMode i").removeClass("icon-eye-close"),$("#admMode i").addClass("icon-eye-open"),a(0))})},onFavorised:function(){$("#favorised").click(function(){campagne_id=$(this).attr("data-campagne-id"),$("#favorised").hasClass("notFavorised")?($("#favorised").removeClass("notFavorised"),$("#favorised i").removeClass("icon-star-empty"),$("#favorised i").addClass("icon-star"),b(campagne_id,1)):($("#favorised").addClass("notFavorised"),$("#favorised i").removeClass("icon-star"),$("#favorised i").addClass("icon-star-empty"),b(campagne_id,0))})}}},campagneController=campagneControllerImpl();onLoadController.campagnes.push(campagneController.onAdminOpenChanged),onLoadController.campagnes.push(campagneController.onFavorised);var chatControllerImpl=function(){function a(){0==h&&(h=1,$.ajax({type:"GET",url:BASE_PATH+"/chat/last",timeout:5e3,data:{isFirst:d,lastId:g},success:function(a){if($("#text").html()!=a){var b,e=$("#text"),i=$("#messageContent"),j=i.height()-300;if(b=e[0].scrollTop==j?!0:!1,deleted=a.deleted,g=a.last_id.trim(),lastMsg=a.last_msg,d){var k="",l=f.substring(0,f.lastIndexOf("</tr>")),m=f.substring(f.lastIndexOf("</tr>")+5);k=l+"</tr>"+lastMsg+m,f=k,$("#text").html(k)}else $("#tableChat tr:last").after(lastMsg);deleted.forEach(function(a){$("#chat_tr_"+a.messageId).remove()}),i=$("#messages_content"),j=i.height()-300,1==b&&(e[0].scrollTop=e[0].scrollHeight),1!=c&&(e.animate({scrollTop:e[0].scrollHeight},2e3),c=!0)}h=0,d&&(d=!1)},error:function(){h=0}}))}function b(){$.ajax({type:"GET",url:BASE_PATH+"/chat/users",success:function(a){$("#onlineUsers").html(a)},error:function(){}})}var c=!1,d=!0,e=2e3,f="",g=0,h=0;return{postMessage:function(a){textMsg=$("#messageChat").val(),$("#messageChat").val(""),$.ajax({type:"POST",url:BASE_PATH+"/chat/post",data:{message:textMsg,user:a},success:function(){},error:function(){$("#messageChat").val(textMsg)}})},postMessageMobile:function(a){textMsg=$("#messageChatMobile").val(),$("#messageChatMobile").val(""),$.ajax({type:"POST",url:BASE_PATH+"/chat/post",data:{message:textMsg,user:a},success:function(){},error:function(){$("#messageChatMobile").val(textMsg)}})},deleteLastMessages:function(){$.ajax({type:"POST",url:BASE_PATH+"/chat/removelast",data:{nbToDelete:30},success:function(){},error:function(){}})},initMessage:function(){a(),window.setInterval(a,e)},initOnline:function(){b(),window.setInterval(b,3e4)}}},chatController=chatControllerImpl();onLoadController.withChats.push(chatController.initMessage),onLoadController.withChats.push(chatController.initOnline);var draftControllerImpl=function(){return{ajaxEnreg:function(a){topic_id=$("input[name=topic_id]").val(),perso_id=$("input[name=perso_id]").val(),tinyMCE.triggerSave(),content=$("#content").val(),$.ajax({type:"POST",url:BASE_PATH+"/forum/"+a+"/topic/draft",data:{topic_id:topic_id,perso_id:perso_id,content:content},success:function(a){$("#enregResult").text(a)},error:function(){}})}}},draftController=draftControllerImpl(),notifControllerImpl=function(){var a=function(){var a=$("#notifNumber"),c=a.text().trim();c-=1,a.text(c),0==c&&b()},b=function(){$("#notifNumber").text("0"),$("#notifIndicator").removeClass("btn-notifs"),$("#notifIndicator").addClass("btn-default"),$("#msg-zone").text("")},c=function(a){$.ajax({type:"POST",url:BASE_PATH+"/notification/del",data:{id:a},success:function(){},error:function(){}})};return{deleteNotif:function(b){c(b),a()},clearNotif:function(){$(".notifMsg").each(function(){idNotif=$(this).attr("id").replace("notif",""),c(idNotif)}),b()},toggleNotif:function(){$("#notif").hasClass("notifHide")?$("#notif").removeClass("notifHide"):$("#notif").addClass("notifHide")},onClickHorsDiv:function(){var a=$("#notif");$(document.body).click(function(b){if(!a.hasClass("notifHide")){var c=window.event||arguments[0],d=c.target||c.srcElement;if(-1==d.id.indexOf("notif")&&0==$(d).parents("#notificationCenter").length){var e=b?b.target:event.srcElement;e!==a&&a.addClass("notifHide")}}})}}},notifController=notifControllerImpl();onLoadController.generals.push(notifController.onClickHorsDiv);var uiControllerImpl=function(){function a(){$(".select2").select2({width:"element"})}function b(){$(window).width()>992?($(".maxheight").css({height:$(window).height()-50+"px"}),$(".maxheight").css({overflow:"auto"})):($(".maxheight").css({height:"100%"}),$(".maxheight").css({overflow:"visible"}))}function c(){b(),$(window).resize(function(){b()})}return{activateUi:function(){a(),c()}}},uiController=uiControllerImpl();onLoadController.generals.push(uiController.activateUi);
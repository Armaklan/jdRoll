function filterTable(a,b){searchText=$(a).val().toLowerCase(),$(b+" tr ").each(function(){currentSearchIndex=$(this).find(".filterIndex").val().toLowerCase(),"header"!=currentSearchIndex&&(currentSearchIndex.indexOf(searchText)>-1?($(this).css("display",""),$(this).removeClass("hide")):($(this).css("display","none"),$(this).addClass("hiding")))})}function onBtnDangerClick(a){bootbox.confirm("L'action demandé est une action dangereuse (Suppression, Quitter une partie, ...). Etes-vous sur ? ",function(b){b&&$(a).submit()})}function selectAll(a){var b=$(a).find(".checkAll").is(":checked");$(a).find("tr:not(.hiding)").find("input[type=checkbox]").prop("checked",b)}function alarm(a,b){var c=0;if($(".alarm-pj").hasClass("alarm-on")){$(".alarm-pj").removeClass("alarm-on");var c=0}else{$(".alarm-pj").addClass("alarm-on");var c=1}$.ajax({type:"POST",url:"/campagne/alarm",data:{joueur:a,campagne:b,statut:c},success:function(){},error:function(){}})}var selected=[];-1!=navigator.userAgent.indexOf("IE")?(tinymce.init({selector:".wysiwyg",plugins:["link image lists preview hr insertdatetime","table template textcolor fullscreen","emoticons code spellchecker"],browser_spellcheck:!0,convert_urls:!1,spellchecker_languages:"+French=fr",spellchecker_rpc_url:"{{app.request.baseUrl}}/tinymce/plugins/spellchecker/rpc.php",toolbar:"cut copy paste | styleselect removeformat | bold italic forecolor | alignleft aligncenter alignright alignjustify | hr | bullist numlist outdent indent | link image | preview fullscreen | emoticons private hide",style_formats:[{title:"Dialogue",inline:"span",classes:"dialogue",styles:{color:"#4488CC"}},{title:"Pensée",inline:"span",classes:"pensee",styles:{color:"#8844CC"}},{title:"Hrp",inline:"span",classes:"hrp",styles:{color:"grey"}},{title:"Titre 1",block:"h1"},{title:"Titre 2",block:"h2"},{title:"Titre 3",block:"h3"}],autosave_ask_before_unload:!1,setup:function(a){a.addButton("private",{text:"Prv",icon:!1,onclick:function(){a.windowManager.open({title:"Message privée",body:[{type:"listbox",name:"users",multiple:"true",size:"large",width:"200",values:specificValue,onselect:function(a){-1==selected.indexOf(a.control.value())?selected.push(a.control.value()):selected.splice(a.control.value())}}],onsubmit:function(){var b=tinyMCE.activeEditor.selection.getContent();a.insertContent("[private="+selected.join()+"]"+b+"[/private]")}})}}),a.addButton("hide",{text:"Hid",icon:!1,onclick:function(){var b=tinyMCE.activeEditor.selection.getContent();a.insertContent("[hide]"+b+"[/hide]")}})},min_height:160}),tinymce.init({selector:".note-wysiwyg",plugins:["link image lists preview hr insertdatetime","table template textcolor fullscreen","emoticons code spellchecker"],browser_spellcheck:!0,convert_urls:!1,spellchecker_languages:"+French=fr",spellchecker_rpc_url:"{{app.request.baseUrl}}/tinymce/plugins/spellchecker/rpc.php",toolbar:"cut copy paste | styleselect removeformat | bold italic forecolor | alignleft aligncenter alignright alignjustify | hr | bullist numlist outdent indent | link image | preview fullscreen | emoticons private hide",style_formats:[{title:"Dialogue",inline:"span",classes:"dialogue",styles:{color:"#4488CC"}},{title:"Pensée",inline:"span",classes:"pensee",styles:{color:"#8844CC"}},{title:"Hrp",inline:"span",classes:"hrp",styles:{color:"grey"}},{title:"Titre 1",block:"h1"},{title:"Titre 2",block:"h2"},{title:"Titre 3",block:"h3"}],autosave_ask_before_unload:!1,setup:function(a){a.addButton("private",{text:"Prv",icon:!1,onclick:function(){a.windowManager.open({title:"Message privée",body:[{type:"listbox",name:"users",multiple:"true",size:"large",width:"200",values:specificValue,onselect:function(a){-1==selected.indexOf(a.control.value())?selected.push(a.control.value()):selected.splice(a.control.value())}}],onsubmit:function(){var b=tinyMCE.activeEditor.selection.getContent();a.insertContent("[private="+selected.join()+"]"+b+"[/private]")}})}}),a.addButton("hide",{text:"Hid",icon:!1,onclick:function(){var b=tinyMCE.activeEditor.selection.getContent();a.insertContent("[hide]"+b+"[/hide]")}})},min_height:160})):window.matchMedia("(min-width: 600px)").matches?(tinymce.init({selector:".wysiwyg",plugins:["link image lists preview hr insertdatetime","table template textcolor fullscreen","emoticons code spellchecker"],browser_spellcheck:!0,convert_urls:!1,spellchecker_languages:"+French=fr",spellchecker_rpc_url:"{{app.request.baseUrl}}/tinymce/plugins/spellchecker/rpc.php",toolbar:"cut copy paste | styleselect removeformat | bold italic forecolor | alignleft aligncenter alignright alignjustify | hr | bullist numlist outdent indent | link image | preview fullscreen | emoticons private hide",style_formats:[{title:"Dialogue",inline:"span",classes:"dialogue",styles:{color:"#4488CC"}},{title:"Pensée",inline:"span",classes:"pensee",styles:{color:"#8844CC"}},{title:"Hrp",inline:"span",classes:"hrp",styles:{color:"grey"}},{title:"Titre 1",block:"h1"},{title:"Titre 2",block:"h2"},{title:"Titre 3",block:"h3"}],autosave_ask_before_unload:!1,setup:function(a){a.addButton("private",{text:"Prv",icon:!1,onclick:function(){a.windowManager.open({title:"Message privée",body:[{type:"listbox",name:"users",multiple:"true",size:"large",width:"200",values:specificValue,onselect:function(a){-1==selected.indexOf(a.control.value())?selected.push(a.control.value()):selected.splice(a.control.value())}}],onsubmit:function(){var b=tinyMCE.activeEditor.selection.getContent();a.insertContent("[private="+selected.join()+"]"+b+"[/private]")}})}}),a.addButton("hide",{text:"Hid",icon:!1,onclick:function(){var b=tinyMCE.activeEditor.selection.getContent();a.insertContent("[hide]"+b+"[/hide]")}})},min_height:400}),tinymce.init({selector:".note-wysiwyg",plugins:["link image lists preview hr insertdatetime","table template textcolor fullscreen","emoticons code spellchecker"],browser_spellcheck:!0,convert_urls:!1,spellchecker_languages:"+French=fr",spellchecker_rpc_url:"{{app.request.baseUrl}}/tinymce/plugins/spellchecker/rpc.php",toolbar:"cut copy paste | styleselect removeformat | bold italic forecolor | alignleft aligncenter alignright alignjustify | hr | bullist numlist outdent indent | link image | preview fullscreen | emoticons private hide",style_formats:[{title:"Dialogue",inline:"span",classes:"dialogue",styles:{color:"#4488CC"}},{title:"Pensée",inline:"span",classes:"pensee",styles:{color:"#8844CC"}},{title:"Hrp",inline:"span",classes:"hrp",styles:{color:"grey"}},{title:"Titre 1",block:"h1"},{title:"Titre 2",block:"h2"},{title:"Titre 3",block:"h3"}],autosave_ask_before_unload:!1,setup:function(a){a.addButton("private",{text:"Prv",icon:!1,onclick:function(){a.windowManager.open({title:"Message privée",body:[{type:"listbox",name:"users",multiple:"true",size:"large",width:"200",values:specificValue,onselect:function(a){-1==selected.indexOf(a.control.value())?selected.push(a.control.value()):selected.splice(a.control.value())}}],onsubmit:function(){var b=tinyMCE.activeEditor.selection.getContent();a.insertContent("[private="+selected.join()+"]"+b+"[/private]")}})}}),a.addButton("hide",{text:"Hid",icon:!1,onclick:function(){var b=tinyMCE.activeEditor.selection.getContent();a.insertContent("[hide]"+b+"[/hide]")}})},min_height:400})):(tinymce.init({selector:".wysiwyg",plugins:["link image lists preview hr insertdatetime","table template textcolor fullscreen","emoticons code"],menubar:!1,browser_spellcheck:!0,convert_urls:!1,toolbar:"paste | styleselect removeformat | bold italic | hr | link image | code",style_formats:[{title:"Dialogue",inline:"span",classes:"dialogue",styles:{color:"#4488CC"}},{title:"Pensée",inline:"span",classes:"pensee",styles:{color:"#8844CC"}},{title:"Hrp",inline:"span",classes:"hrp",styles:{color:"grey"}},{title:"Titre 1",block:"h1"},{title:"Titre 2",block:"h2"},{title:"Titre 3",block:"h3"}],autosave_ask_before_unload:!1,min_height:160,width:300}),tinymce.init({selector:".note-wysiwyg",plugins:["link image lists preview hr insertdatetime","table template textcolor fullscreen","emoticons code"],menubar:!1,browser_spellcheck:!0,convert_urls:!1,toolbar:"paste | styleselect removeformat | bold italic | hr | link image | code",style_formats:[{title:"Dialogue",inline:"span",classes:"dialogue",styles:{color:"#4488CC"}},{title:"Pensée",inline:"span",classes:"pensee",styles:{color:"#8844CC"}},{title:"Hrp",inline:"span",classes:"hrp",styles:{color:"grey"}},{title:"Titre 1",block:"h1"},{title:"Titre 2",block:"h2"},{title:"Titre 3",block:"h3"}],autosave_ask_before_unload:!1,min_height:160,width:300}));var onLoadControllerImpl=function(){function a(a){a.forEach(function(a){a()})}var b=[],c=[],d=[];return{generals:b,campagnes:c,withChats:d,onLoadGenerals:function(){a(b)},onLoadChat:function(){a(d)},onLoadCampagnes:function(){a(c)}}},onLoadController=onLoadControllerImpl(),campagneControllerImpl=function(){function a(a){0!=CAMPAGNE_ID&&$.ajax({type:"POST",url:BASE_PATH+"/campagne/admin_open",data:{id:CAMPAGNE_ID,state:a},success:function(){},error:function(){}})}function b(a,b){$.ajax({type:"POST",url:BASE_PATH+"/campagne/favoris",data:{campagne:a,statut:b},success:function(){},error:function(){}})}return{onAdminOpenChanged:function(){$("#admMode").click(function(){$("#admMode").hasClass("admDisabled")?($("#admMode").removeClass("admDisabled"),$(".admIcone").removeClass("invisible"),$("#admMode i").removeClass("icon-eye-open"),$("#admMode i").addClass("icon-eye-close"),a(1)):($("#admMode").addClass("admDisabled"),$(".admIcone").addClass("invisible"),$("#admMode i").removeClass("icon-eye-close"),$("#admMode i").addClass("icon-eye-open"),a(0))})},onFavorised:function(){$("#favorised").click(function(){campagne_id=$(this).attr("data-campagne-id"),$("#favorised").hasClass("notFavorised")?($("#favorised").removeClass("notFavorised"),$("#favorised i").removeClass("icon-star-empty"),$("#favorised i").addClass("icon-star"),b(campagne_id,1)):($("#favorised").addClass("notFavorised"),$("#favorised i").removeClass("icon-star"),$("#favorised i").addClass("icon-star-empty"),b(campagne_id,0))})}}},campagneController=campagneControllerImpl();onLoadController.campagnes.push(campagneController.onAdminOpenChanged),onLoadController.campagnes.push(campagneController.onFavorised);var chatControllerImpl=function(){function a(a){return j[0].scrollTop==a.height()-p?!0:!1}function b(){var a="",b=n.substring(0,n.lastIndexOf("</tr>")),c=n.substring(n.lastIndexOf("</tr>")+5);a=b+"</tr>"+lastMsg+c,n=a,$("#text").html(a)}function c(){$("#tableChat tr:last").after(lastMsg)}function d(a){a.forEach(function(a){$("#chat_tr_"+a.messageId).remove()})}function e(a){$("#messages_content").height()-p;a===!0&&(j[0].scrollTop=j[0].scrollHeight)}function f(){1!=k&&(j.animate({scrollTop:j[0].scrollHeight},2e3),k=!0)}function g(){$.ajax({type:"GET",url:BASE_PATH+"/chat/last",timeout:5e3,data:{isFirst:l,lastId:o}}).done(function(g){if($("#text").html()!=g){var h=($("#text"),$("#messageContent")),i=a(h);o=g.last_id.trim(),lastMsg=g.last_msg,l?b():c(),d(g.deleted),e(i),f(),l=!1}}).always(function(){setTimeout(g,m)})}function h(){j=$("#text"),g()}function i(){$.ajax({type:"GET",url:BASE_PATH+"/chat/users",success:function(a){$("#onlineUsers").html(a)},error:function(){}})}var j,k=!1,l=!0,m=1500,n="",o=0,p=300;return{postMessage:function(a){textMsg=$("#messageChat").val(),$("#messageChat").val(""),$.ajax({type:"POST",url:BASE_PATH+"/chat/post",data:{message:textMsg,user:a},success:function(){},error:function(){$("#messageChat").val(textMsg)}})},postMessageMobile:function(a){textMsg=$("#messageChatMobile").val(),$("#messageChatMobile").val(""),$.ajax({type:"POST",url:BASE_PATH+"/chat/post",data:{message:textMsg,user:a},success:function(){},error:function(){$("#messageChatMobile").val(textMsg)}})},deleteLastMessages:function(){$.ajax({type:"POST",url:BASE_PATH+"/chat/removelast",data:{nbToDelete:30},success:function(){},error:function(){}})},initMessage:function(){h()},initOnline:function(){i(),window.setInterval(i,3e4)}}},chatController=chatControllerImpl();onLoadController.withChats.push(chatController.initMessage),onLoadController.withChats.push(chatController.initOnline);var draftControllerImpl=function(){function a(){var a=new Date;return a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}function b(){$("#enregResult").html("Enregistré à "+a()+' <i class="icon-save"></i>')}function c(){topic_id=$("input[name=topic_id]").val(),perso_id=$("input[name=perso_id]").val(),tinyMCE.triggerSave(),content=$("#content").val(),$.ajax({type:"POST",url:BASE_PATH+"/forum/"+CAMPAGNE_ID+"/topic/draft",data:{topic_id:topic_id,perso_id:perso_id,content:content},success:function(){b()},error:function(){}})}function d(){var a=$("#btn-enreg");a.length&&window.setInterval(c,6e4)}return{ajaxEnreg:c,autoSave:d}},draftController=draftControllerImpl();onLoadController.generals.push(draftController.autoSave);var notifControllerImpl=function(){function a(){$.ajax({type:"GET",url:BASE_PATH+"/notification/ajax",success:function(a){$("#notificationCenter").html(a.content),$("#notifNumber").html(a.nb_notif),a.nb_notif>0?($("#notifIndicator").addClass("btn-notifs"),$("#notifIndicator").removeClass("btn-default")):($("#notifIndicator").removeClass("btn-notifs"),$("#notifIndicator").addClass("btn-default"))},error:function(){}})}var b=function(){var a=$("#notifNumber"),b=a.text().trim();b-=1,a.text(b),0==b&&c()},c=function(){$("#notifNumber").text("0"),$("#notifIndicator").removeClass("btn-notifs"),$("#notifIndicator").addClass("btn-default"),$("#msg-zone").text("")},d=function(a){$.ajax({type:"POST",url:BASE_PATH+"/notification/del",data:{id:a},success:function(){},error:function(){}})};return{deleteNotif:function(a){d(a),b()},clearNotif:function(){$(".notifMsg").each(function(){idNotif=$(this).attr("id").replace("notif",""),d(idNotif)}),c()},toggleNotif:function(){$("#notif").hasClass("notifHide")?$("#notif").removeClass("notifHide"):$("#notif").addClass("notifHide")},onClickHorsDiv:function(){var a=$("#notif");$(document.body).click(function(b){if(!a.hasClass("notifHide")){var c=window.event||arguments[0],d=c.target||c.srcElement;if(-1==d.id.indexOf("notif")&&0==$(d).parents("#notificationCenter").length){var e=b?b.target:event.srcElement;e!==a&&a.addClass("notifHide")}}})},ajaxRefresh:function(){window.setInterval(a,12e4)}}},notifController=notifControllerImpl();onLoadController.generals.push(notifController.ajaxRefresh),onLoadController.generals.push(notifController.onClickHorsDiv);var uiControllerImpl=function(){function a(){$(".select2").select2({width:"element"})}function b(){$(window).width()>992?($(".maxheight").css({height:$(window).height()-50+"px"}),$(".maxheight").css({overflow:"auto"})):($(".maxheight").css({height:"100%"}),$(".maxheight").css({overflow:"visible"}))}function c(){b(),$(window).resize(function(){b()})}function d(){ZeroClipboard.config({moviePath:BASE_PATH+"/vendor/zeroclipboard/ZeroClipboard.swf"}),f=new ZeroClipboard($("#btn-upload-copy"))}function e(){f.on("load",function(){}),f.on("complete",function(){alert("Url copié dans le presse papier ")})}var f;return{activateUi:function(){a(),c(),d(),e()}}},uiController=uiControllerImpl();onLoadController.generals.push(uiController.activateUi);var uiDicerImpl=function(){function a(a,b,c){return $.ajax({type:"POST",url:e+a,data:{param:b,description:c}})}function b(){var a=new Date;return a.getFullYear()+"-"+a.getMonth()+"1-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}function c(b){return param=$("#dicerParamQuick").val(),description=$("#dicerDescriptionQuick").val(),$("#waitingQuickLaunch").removeClass("hide"),a(b,param,description).done(function(a){$("#resultatDicerQuick").html(a);var b="Vous avez lancé "+param+" et obtenu : "+a+"<br>Description : "+description;$("#quickDicerRow").before("<tr>    <td></td>    <td>"+b+"</td></tr>")}).fail(function(){$("#resultatDicerQuick").html("Une erreur s'est produite.")}).always(function(){$("#waitingQuickLaunch").addClass("hide")}),!1}function d(){return param=$("#dicerParam").val(),description=$("#dicerDescription").val(),$("#waitingLaunch").removeClass("hide"),a(0,param,description).then(function(a){$("#resultatDicer").html(a);var c=b();$("#resultatDicerTable tbody tr:first").before("<tr>    <td></td>    <td>"+c+"</td>    <td>"+description+"</td>    <td>"+a+"</td></tr>")}).fail(function(){$("#resultatDicer").html("Une erreur s'est produite.")}).always(function(){$("#waitingLaunch").addClass("hide")}),!1}var e=BASE_PATH+"/campagne/dicer/"+CAMPAGNE_ID+"/";return{dicerModalLaunch:d,dicerLaunch:c}},uiDicer=uiDicerImpl(),uiCharacterModalControllerImpl=function(){function a(){$("#persoModal").dialog({height:"auto",width:"auto",autoOpen:!1}).removeClass("ui-widget")}function b(){$("#persoModal").dialog("isOpen")||$("#persoModal").dialog("open")}function c(){$("#zoneFichepopUp").has("#zoneFicheCustomPopUp").length>0&&($(".ui-dialog-titlebar").append('<a href="#" id="SaveFDP" class="btn iconeBtn sidebarBtn quickLink2 FDPToolBarBtn" title="Sauvegarder" role="button"><span><i class="icon-save"></i></span></a>'),$(".ui-dialog-titlebar").append('<a href="#" id="EditFDP" class="btn iconeBtn sidebarBtn quickLink2 FDPToolBarBtn" title="Editer la fiche" role="button"><span><i class="icon-edit"></i></span></a>'));var a=BASE_PATH+"/perso/view_all/"+CAMPAGNE_ID;$(".ui-dialog-titlebar").append('<a id="SwitchFDP" href="'+a+'" class="btn iconeBtn sidebarBtn quickLink2 FDPToolBarBtn" title="Personnages" role="button"><span><i class="icon-user"></i></span></a>')}function d(){$("#EditFDP").click(function(){"none"==$("#SaveFDP").css("display")?$("#SaveFDP").css("display","block"):$("#SaveFDP").css("display","none"),$("#zoneFichepopUp .editable").each(function(){"rgb(0, 136, 204)"==$(this).css("color")?$(this).css("color","").editable("toggleDisabled"):$(this).css("color","#0088cc").editable("toggleDisabled"),"none"==$(this).css("display")&&($(this).css("display",""),$(this).addClass("editable-empty")),$(this).hasClass("editable-empty")&&("none"==$("#SaveFDP").css("display")&&$(this).css("display","none"),$(this).css("color","#DD1144"))})})}function e(){$("#SaveFDP").click(function(){var a="";$("#zoneFicheCustomPopUp").find('input[id$="hidden"]').each(function(){a+=$(this)[0].outerHTML}),$.ajax({type:"POST",url:BASE_PATH+"/campagne/persoModal/save/popup/"+CAMPAGNE_ID,data:{fields:a},success:function(){},error:function(){alert("Echec de sauvegarde de la fiche de personnage !")}})})}function f(){0===$(".ui-dialog-titlebar").has("#SwitchFDP").length&&(c(),b())}return{prepareModal:function(){$("#persoModal").css("display","none"),a(),d(),e()},onPersoBtnClick:function(){$("#myPerso").click(function(){f()})}}},uiCharacterModalController=uiCharacterModalControllerImpl();onLoadController.campagnes.push(uiCharacterModalController.prepareModal),onLoadController.campagnes.push(uiCharacterModalController.onPersoBtnClick),$(function(){$(".collapserLink").click(function(a){a.preventDefault();var b=$(this).children("i");b.hasClass("icon-chevron-sign-down")?b.removeClass("icon-chevron-sign-down").addClass("icon-chevron-sign-up"):b.removeClass("icon-chevron-sign-up").addClass("icon-chevron-sign-down")})}),$(function(){$("a.btn-danger").click(function(a){a.stopPropagation(),a.preventDefault();var b=$(this).attr("href");bootbox.confirm("L'action demandé est une action dangereuse (Suppression, Quitter une partie, ...). Etes-vous sur ? ",function(a){a&&window.location.replace(b)})})}),$(".iconeBtn").tooltip(),$(".colorpicker").colorpicker(),$(".focus-elt").focus();
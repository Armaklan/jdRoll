function filterTable(a,b){var c=$(a).val().toLowerCase();$(b+" tr ").each(function(){currentSearchIndex=$(this).find(".filterIndex").val().toLowerCase(),"header"!=currentSearchIndex&&(currentSearchIndex.indexOf(c)>-1?($(this).css("display",""),$(this).removeClass("hide")):($(this).css("display","none"),$(this).addClass("hiding")))})}function filterList(a,b){var c=$(a).val().toLowerCase();$(b+" > div ").each(function(){currentSearchIndex=$(this).find(".filterIndex").val().toLowerCase(),"header"!=currentSearchIndex&&(currentSearchIndex.indexOf(c)>-1?($(this).css("display",""),$(this).removeClass("hide")):($(this).css("display","none"),$(this).addClass("hiding")))})}function onBtnDangerClick(a){bootbox.confirm("L'action demandé est une action dangereuse (Suppression, Quitter une partie, ...). Etes-vous sur ? ",function(b){b&&$(a).submit()})}function selectAll(a){var b=$(a).find(".checkAll").is(":checked");$(a).find("tr:not(.hiding)").find("input[type=checkbox]").prop("checked",b)}function alarm(a,b){var c=0,d=$(".alarm-pj");d.hasClass("alarm-on")?(d.removeClass("alarm-on"),c=0):(d.addClass("alarm-on"),c=1),$.ajax({type:"POST",url:"/campagne/alarm",data:{joueur:a,campagne:b,statut:c},success:function(){},error:function(){}})}var selected=[],formats=[{title:"Dialogue",inline:"span",classes:"dialogue"},{title:"Pensée",inline:"span",classes:"pensee"},{title:"RP1",inline:"span",classes:"rp1"},{title:"RP2",inline:"span",classes:"rp2"},{title:"Hrp",inline:"span",classes:"hrp"},{title:"Titre 1",block:"h1"},{title:"Titre 2",block:"h2"},{title:"Titre 3",block:"h3"},{title:"Citation",block:"blockquote"}],configBase={plugins:["link image lists hr","table textcolor fullscreen","emoticons code"],content_css:BASE_PATH+"/css/main.css",browser_spellcheck:!0,convert_urls:!1,toolbar:"cut copy paste | styleselect removeformat | bold italic forecolor | alignleft aligncenter alignright alignjustify | hr | bullist numlist outdent indent | link image | fullscreen | emoticons private hide popup perso perso2",style_formats:formats,autosave_ask_before_unload:!1,setup:function(a){a.addButton("private",{text:"Prv",icon:!1,onclick:function(){a.windowManager.open({title:"Message privé",url:"/editor/tagPrivate/"+CAMPAGNE_ID,height:"280",buttons:[{text:"OK",classes:"widget btn primary first abs-layout-item",disabled:!1,onclick:function(){{var b="/editor/tagPrivate/"+CAMPAGNE_ID,c=[];$("iframe[src='"+b+"']").contents().find("select option:selected").each(function(){c.push($(this).val())})}a.execCommand("mceInsertContent",0,"[private="+c.join(",")+"]"+a.selection.getContent()+"[/private]"),a.windowManager.close()}},{text:"Cancel",onclick:"close"}]})}}),a.addButton("hide",{text:"Hid",icon:!1,onclick:function(){var b=tinyMCE.activeEditor.selection.getContent();a.insertContent("[hide]"+b+"[/hide]")}}),a.addButton("popup",{text:"Pop",icon:!1,onclick:function(){a.windowManager.open({title:"Informations Popup",body:[{type:"textbox",name:"title",label:"Titre :"},{type:"textbox",name:"link",label:"Lien affiché :"}],onsubmit:function(b){var c=tinyMCE.activeEditor.selection.getContent();a.insertContent("[popup="+b.data.title+","+b.data.link+"]"+c+"[/popup]")}})}}),a.addButton("perso",{text:"PNJ",icon:!1,onclick:function(){a.windowManager.open({title:"Lien vers fiche PNJ",url:"/editor/tagPerso/"+CAMPAGNE_ID,height:"280",buttons:[{text:"OK",classes:"widget btn primary first abs-layout-item",disabled:!1,onclick:function(){var b="/editor/tagPerso/"+CAMPAGNE_ID,c=$("iframe[src='"+b+"']").contents().find("select option:selected").val();a.execCommand("mceInsertContent",0,"[pnj="+c+"]"+a.selection.getContent()+"[/pnj]"),a.windowManager.close()}},{text:"Cancel",onclick:"close"}]})}})}},configPost=jQuery.extend(!0,{},configBase);configPost.min_height=160,configPost.selector=".wysiwyg";var configMobile=jQuery.extend(!0,{},configBase);configMobile.plugins=["link image lists hr","table textcolor fullscreen","emoticons code"],configMobile.toolbar="paste | styleselect removeformat | bold italic | hr | link image | code",configMobile.menubar=!1,configMobile.min_height=400,configMobile.selector=".wysiwyg";var configNote=jQuery.extend(!0,{},configBase);configNote.toolbar="cut copy paste | styleselect removeformat | bold italic forecolor | alignleft aligncenter alignright alignjustify | hr | bullist numlist outdent indent | link image | fullscreen | emoticons",configNote.min_height=160,configNote.selector=".note-wysiwyg";var configNoteMobile=jQuery.extend(!0,{},configNote);configNoteMobile.min_height=160,configNoteMobile.width=300,configNoteMobile.selector=".note-wysiwyg",-1!=navigator.userAgent.indexOf("IE")?(tinymce.init(configPost),tinymce.init(configNote)):window.matchMedia("(min-width: 600px)").matches?(tinymce.init(configPost),tinymce.init(configNote)):(tinymce.init(configMobile),tinymce.init(configNoteMobile));var onLoadControllerImpl=function(){function a(a){a.forEach(function(a){a()})}var b=[],c=[],d=[];return{generals:b,campagnes:c,withChats:d,onLoadGenerals:function(){a(b)},onLoadChat:function(){a(d)},onLoadCampagnes:function(){a(c)}}},onLoadController=onLoadControllerImpl(),campagneControllerImpl=function(){function a(a){0!==CAMPAGNE_ID&&$.ajax({type:"POST",url:BASE_PATH+"/campagne/admin_open",data:{id:CAMPAGNE_ID,state:a},success:function(){},error:function(){}})}function b(a,b){$.ajax({type:"POST",url:BASE_PATH+"/campagne/favoris",data:{campagne:a,statut:b},success:function(){},error:function(){}})}return{onAdminOpenChanged:function(){$("#admMode").click(function(){$("#admMode").hasClass("admDisabled")?($("#admMode").removeClass("admDisabled"),$(".admIcone").removeClass("invisible"),$("#admMode i").removeClass("icon-eye-open"),$("#admMode i").addClass("icon-eye-close"),a(1)):($("#admMode").addClass("admDisabled"),$(".admIcone").addClass("invisible"),$("#admMode i").removeClass("icon-eye-close"),$("#admMode i").addClass("icon-eye-open"),a(0))})},onFavorised:function(){$("#favorised").click(function(){var a=$(this).attr("data-campagne-id");$("#favorised").hasClass("notFavorised")?($("#favorised").removeClass("notFavorised"),$("#favorised i").removeClass("icon-star-empty"),$("#favorised i").addClass("icon-star"),b(a,1)):($("#favorised").addClass("notFavorised"),$("#favorised i").removeClass("icon-star"),$("#favorised i").addClass("icon-star-empty"),b(a,0))})}}},campagneController=campagneControllerImpl();onLoadController.campagnes.push(campagneController.onAdminOpenChanged),onLoadController.campagnes.push(campagneController.onFavorised);var chatControllerImpl=function(){function a(a){return k[0].scrollTop==a.height()-q}function b(){var a=o.substring(0,o.lastIndexOf("</tr>")),b=o.substring(o.lastIndexOf("</tr>")+5),c=a+"</tr>"+lastMsg+b;o=c,$("#text").html(c)}function c(){$("#tableChat tr:last").after(lastMsg)}function d(a){a.forEach(function(a){$("#chat_tr_"+a.messageId).remove()})}function e(a){$("#messages_content").height()-q;a===!0&&(k[0].scrollTop=k[0].scrollHeight)}function f(){1!=l&&(k[0].scrollTop=k[0].scrollHeight,l=!0)}function g(){$.ajax({type:"GET",url:BASE_PATH+"/chat/last",timeout:5e3,data:{isFirst:m,lastId:p}}).done(function(g){if($("#text").html()!=g){var h=($("#text"),$("#messageContent")),i=a(h);p=g.last_id.trim(),lastMsg=g.last_msg,m?b():c(),d(g.deleted),e(i),f(),m=!1}}).always(function(){setTimeout(g,n)})}function h(){k=$("#text"),q=$("#text").height(),g()}function i(){$("#messageChat").on("keyup",function(){"@"==$("#messageChat").val()&&($("#chatTo").select2("open"),$("#messageChat").val(""))})}function j(){$.ajax({type:"GET",url:BASE_PATH+"/chat/users",success:function(a){$("#onlineUsers").html(a)},error:function(){}})}var k,l=!1,m=!0,n=1500,o="",p=0,q=300;return{postMessage:function(a){textMsg=$("#messageChat").val(),$("#messageChat").val(""),to=$("#chatTo").val(),$.ajax({type:"POST",url:BASE_PATH+"/chat/post",data:{message:textMsg,user:a,to:to},success:function(){},error:function(){$("#messageChat").val(textMsg)}})},postMessageMobile:function(a){textMsg=$("#messageChatMobile").val(),$("#messageChatMobile").val(""),to="",$.ajax({type:"POST",url:BASE_PATH+"/chat/post",data:{message:textMsg,user:a,to:to},success:function(){},error:function(){$("#messageChatMobile").val(textMsg)}})},deleteLastMessages:function(){$.ajax({type:"POST",url:BASE_PATH+"/chat/removelast",data:{nbToDelete:30},success:function(){},error:function(){}})},initMessage:function(){h(),i()},initOnline:function(){j(),window.setInterval(j,3e4)}}},chatController=chatControllerImpl();onLoadController.withChats.push(chatController.initMessage),onLoadController.withChats.push(chatController.initOnline);var draftControllerImpl=function(){function a(){var a=new Date;return a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}function b(){$("#enregResult").html("Enregistré à "+a()+' <i class="icon-save"></i>')}function c(){$("#waitingPost").removeClass("hide"),$("#btn-reply").attr("disabled","disabled");var a,b=$("input[name=id]").val(),c=$("input[name=topic_id]").val();a=$("input[name=perso_id]").length?$("input[name=perso_id]").val():$("select[name=perso_id]").select2("val"),tinyMCE.triggerSave(),content=$("#content").val(),$.ajax({type:"POST",timeout:1e4,url:BASE_PATH+"/forum/"+CAMPAGNE_ID+"/post/save",data:{id:b,topic_id:c,perso_id:a,content:content}}).done(function(a){window.location.assign(BASE_PATH+a)}).fail(function(){$("#enregResult").html('<span class="alert alert-danger">Impossible de poster le message <i class="icon-save"></i></span>'),$("#btn-reply").removeAttr("disabled")}).always(function(){$("#waitingPost").addClass("hide")})}function d(){tinyMCE.triggerSave();var a=$("#content").val();$.ajax({type:"POST",url:BASE_PATH+"/forum/"+CAMPAGNE_ID+"/preview",data:{content:a},success:function(a){$("#previewCell").html(a.content),$("tr#previewRow").removeClass("hide")},error:function(){}})}function e(){topic_id=$("input[name=topic_id]").val();var a;a=$("input[name=perso_id]").length?$("input[name=perso_id]").val():$("select[name=perso_id]").select2("val"),tinyMCE.triggerSave(),content=$("#content").val(),$.ajax({type:"POST",url:BASE_PATH+"/forum/"+CAMPAGNE_ID+"/topic/draft",data:{topic_id:topic_id,perso_id:a,content:content},success:function(){b()},error:function(){}})}function f(){var a=$("#btn-enreg");a.length&&window.setInterval(e,6e4)}return{ajaxEnreg:e,autoSave:f,ajaxPost:c,preview:d}},draftController=draftControllerImpl();onLoadController.generals.push(draftController.autoSave);var notifControllerImpl=function(){function a(){$.ajax({type:"GET",url:BASE_PATH+"/notification/ajax",success:function(a){$("#notificationCenter").html(a.content),$("#notifNumber").html(a.nb_notif),a.nb_notif>0?($("#notifIndicator").addClass("btn-notifs"),$("#notifIndicator").removeClass("btn-default")):($("#notifIndicator").removeClass("btn-notifs"),$("#notifIndicator").addClass("btn-default")),f()},error:function(){}})}var b=new Favico({type:"rectangle",animation:"slide"}),c=function(){var a=$("#notifNumber"),b=a.text().trim();b-=1,a.text(b),0==b&&d(),f()},d=function(){$("#notifNumber").text("0"),$("#notifIndicator").removeClass("btn-notifs"),$("#notifIndicator").addClass("btn-default"),$("#msg-zone").text("")},e=function(a){$.ajax({type:"POST",url:BASE_PATH+"/notification/del",data:{id:a},success:function(){},error:function(){}})},f=function(){var a=parseInt($("#notifNumber").html());a?b.badge(a):b.reset()};return f(),{deleteNotif:function(a){e(a),c()},clearNotif:function(){$(".notifMsg").each(function(){var a=$(this).attr("id").replace("notif","");e(a)}),d()},toggleNotif:function(){$("#notif").hasClass("notifHide")?$("#notif").removeClass("notifHide"):$("#notif").addClass("notifHide")},onClickHorsDiv:function(){var a=$("#notif");$(document.body).click(function(b){if(!a.hasClass("notifHide")){var c=window.event||arguments[0],d=c.target||c.srcElement;if(-1==d.id.indexOf("notif")&&0==$(d).parents("#notificationCenter").length){var e=b?b.target:event.srcElement;e!==a&&a.addClass("notifHide")}}})},ajaxRefresh:function(){window.setInterval(a,12e4)}}},notifController=notifControllerImpl();onLoadController.generals.push(notifController.ajaxRefresh),onLoadController.generals.push(notifController.onClickHorsDiv);var uiControllerImpl=function(){function a(){$(".select2").select2({width:"resolve"}),$(document).on("keydown",function(a){l=a.ctrlKey}),$(document).on("keyup",function(a){l=a.ctrlKey}),$(document).on("keypress",function(a){l=a.ctrlKey}),$(".navigationSelect").on("select2-selecting",function(a){m(a.val,l)})}function b(){$(".affix").affix({offset:{top:200},bottom:function(){return this.bottom=$(".footer").outerHeight(!0)}})}function c(){$(".colorpicker").colorpicker()}function d(){$(".iconeBtn").tooltip({container:"body"}),$(".popover-elt").popover()}function e(){$(".focus-elt").focus()}function f(){$(window).width()>992?($(".maxheight").css({height:$(window).height()-50+"px"}),$(".maxheight").css({overflow:"auto"})):($(".maxheight").css({height:"100%"}),$(".maxheight").css({overflow:"visible"}))}function g(){f(),$(window).resize(function(){f()})}function h(){ZeroClipboard.config({moviePath:BASE_PATH+"/vendor/zeroclipboard/ZeroClipboard.swf"}),k=new ZeroClipboard($("#btn-upload-copy"))}function i(){k.on("load",function(){}),k.on("complete",function(){alert("Url copié dans le presse papier ")})}function j(){$(".carousel-control.right").trigger("click")}var k,l=!1,m=function(a,b){""!=a&&(b?window.open(a):window.location=a)};return{activateUi:function(){a(),b(),g(),h(),i(),d(),e(),j(),c()}}},uiController=uiControllerImpl();onLoadController.generals.push(uiController.activateUi);var uiDicerImpl=function(){function a(a,b,c){return $.ajax({type:"POST",url:e+a,data:{param:b,description:c}})}function b(){var a=new Date;return a.getFullYear()+"-"+a.getMonth()+"1-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}function c(b){return param=$("#dicerParamQuick").val(),description=$("#dicerDescriptionQuick").val(),$("#waitingQuickLaunch").removeClass("hide"),a(b,param,description).done(function(a){a=forumController.beautifyDice(a),$("#resultatDicerQuick").html(a);var b="Vous avez lancé "+param+" et obtenu : "+a+"<br>Description : "+description;$("#quickDicerRow").before('<tr>    <td></td>    <td><div class="postContent">'+b+"</div></td>    <td>&nbsp;</td></tr>")}).fail(function(){$("#resultatDicerQuick").html("Une erreur s'est produite.")}).always(function(){$("#waitingQuickLaunch").addClass("hide")}),!1}function d(){var c=$("#dicerParam").val(),d=$("#dicerDescription").val();return $("#waitingLaunch").removeClass("hide"),a(0,c,d).then(function(a){$("#resultatDicer").html(a);var c=b();$("#resultatDicerTable tbody tr:first").before("<tr>    <td></td>    <td>"+c+"</td>    <td>"+d+"</td>    <td>"+a+"</td></tr>")}).fail(function(){$("#resultatDicer").html("Une erreur s'est produite.")}).always(function(){$("#waitingLaunch").addClass("hide")}),!1}var e=BASE_PATH+"/campagne/dicer/"+CAMPAGNE_ID+"/";return{dicerModalLaunch:d,dicerLaunch:c}},uiDicer=uiDicerImpl(),uiCharacterModalControllerImpl=function(){function a(){$("#persoModal").modal("show")}function b(){$("#persoModal .btn-bar").html("");var a=BASE_PATH+"/perso/view_all/"+CAMPAGNE_ID;$("#persoModal .btn-bar").append('<a id="SwitchFDP" href="'+a+'" class="btn iconeBtn sidebarBtn quickLink2 FDPToolBarBtn" title="Personnages" role="button"><span><i class="icon-user"></i></span></a>')}function c(){$("#EditFDP").click(function(){"none"==$("#SaveFDP").css("display")?$("#SaveFDP").css("display","block"):$("#SaveFDP").css("display","none"),$("#zoneFichepopUp .editable").each(function(){"rgb(0, 136, 204)"==$(this).css("color")?$(this).css("color","").editable("toggleDisabled"):$(this).css("color","#0088cc").editable("toggleDisabled"),"none"==$(this).css("display")&&($(this).css("display",""),$(this).addClass("editable-empty")),$(this).hasClass("editable-empty")&&("none"==$("#SaveFDP").css("display")&&$(this).css("display","none"),$(this).css("color","#DD1144"))})})}function d(){$("#SaveFDP").click(function(){var a="";$("#zoneFicheCustomPopUp").find('input[id$="hidden"]').each(function(){a+=$(this)[0].outerHTML}),$.ajax({type:"POST",url:BASE_PATH+"/campagne/persoModal/save/popup/"+CAMPAGNE_ID,data:{fields:a},success:function(){},error:function(){alert("Echec de sauvegarde de la fiche de personnage !")}})})}function e(){0===$(".ui-dialog-titlebar").has("#SwitchFDP").length&&(b(),a())}return{prepareModal:function(){c(),d()},onPersoBtnClick:function(){$("#myPerso").click(function(){e()})}}},uiCharacterModalController=uiCharacterModalControllerImpl();onLoadController.campagnes.push(uiCharacterModalController.prepareModal),onLoadController.campagnes.push(uiCharacterModalController.onPersoBtnClick);var persoModalService=function(){"use strict";var a={},b=BASE_PATH+"/perso/ajax/",c=function(a,c){return b+a+"/"+c},d=function(){return $("#genPersoModal")},e=function(){return $("#genPersoModal .modal-body")},f=function(){return $("#genPersoModal .modal-name")},g=function(a,b){return $.ajax({type:"GET",url:c(a,b)})};return a.openPerso=function(a,b){f().html("Chargement en cours..."),e().html(""),g(a,b).done(function(a){e().html(a.content),f().html(a.name)}),d().modal("show")},a}(),themeService=function(){"use strict";var a={},b=function(a){$(".categorie").css("background-color",a),$(".sidebar").css("background-color",a)},c=function(a){$("#theme-container a").css("color",a)},d=function(a){$(".sidebar a").css("color",a),$(".sidebar").css("color",a),$("a.sidebarBtn").css("color","black")},e=function(a){$("#theme-container").css("color",a)},f=function(a){$(".table-striped tbody > tr:nth-child(2n+1) > td").css("background-color",a),$(".table-striped tbody > tr:nth-child(2n+1) > th").css("background-color",a)},g=function(a){$(".table-striped tbody > tr:nth-child(2n) > td").css("background-color",a),$(".table-striped tbody > tr:nth-child(2n) > th").css("background-color",a)},h=function(a){$(".container-fluid .dialogue").css("color",a)},i=function(a){$(".container-fluid .pensee").css("color",a)},j=function(a){$(".container-fluid .rp1").css("color",a)},k=function(a){$(".container-fluid .rp2").css("color",a)},l=function(a){$(".container-fluid blockquote p").css("color",a),$(".container-fluid blockquote").css("color",a)},m=function(){var a=$("#hr").val();$("hr").css("background-image","url("+a+")")},n=function(){var a=$("#bann").val();$(".logo_campagne").css("background-image","url("+a+")")},o=function(a){return $.ajax({type:"GET",url:BASE_PATH+"/themes/"+a})};return a.refresh=function(){f($("#odd_line_color").val()),g($("#even_line_color").val()),e($("#text_color").val()),b($("#sidebar_color").val()),c($("#link_color").val()),d($("#link_sidebar_color").val()),h($("#dialogue_color").val()),i($("#pensee_color").val()),j($("#rp1_color").val()),k($("#rp2_color").val()),m(),n(),l($("#quote_color").val())},a.apply=function(){var b=$("#theme-choice").val();o(b).done(function(b){$("#odd_line_color").val(b.odd_line_color),$("#even_line_color").val(b.even_line_color),$("#text_color").val(b.text_color),$("#sidebar_color").val(b.sidebar_color),$("#link_color").val(b.link_color),$("#link_sidebar_color").val(b.link_sidebar_color),$("#dialogue_color").val(b.dialogue_color),$("#pensee_color").val(b.pensee_color),$("#rp1_color").val(b.rp1_color),$("#rp2_color").val(b.rp2_color),$("#quote_color").val(b.quote_color),a.refresh()})},a}(),campagneConfig=function(a){"use strict";var b={},c=BASE_PATH+"/campagne/",d=function(a,b){return c+a+"/"+b},e=function(a,b,d){return c+a+"/"+b+"/"+d},f=function(a,b,c){return $.ajax({type:"POST",url:d(b,a),data:c})},g=function(a,b,c){return $.ajax({type:"GET",url:e(a,b,c)})},h=function(a,b){$("#campagneMsg").html("<div class='alert alert-"+a+"'> "+b+"</div>")};return b.saveDescription=function(b){a.triggerSave();var c=$("#gameDescForm").serialize();return f("desc",b,c).done(function(){h("success","Campagne sauvegardé")}).fail(function(a){h("danger",a)}),!1},b.saveSheet=function(b){a.triggerSave();var c,d="";c=1==mode?$("#zoneFiche").clone():$("#zoneFicheCustom").clone(),c.find(".editable-popup").each(function(){$(this).remove()}),c.find('div[id^="JDRollUserControl_"]').each(function(){d+=$(this)[0].outerHTML,$(this).remove()}),$("#hiddenInput").val(c.html()),$("#hiddenInputFields").val(d);var e=$("#gameSheetForm").serialize();return f("sheet",b,e).done(function(){h("success","Feuille de personnage sauvegardé")}).fail(function(a){h("danger",a)}),!1},b.saveTheme=function(a){var b=$("#gameThemeForm").serialize();return f("theme",a,b).done(function(){h("success","Thème sauvegardé")}).fail(function(a){h("danger",a)}),!1},b.saveDivers=function(b){a.triggerSave();var c=$("#gameDiversForm").serialize();return f("divers",b,c).done(function(){h("success","Campagne sauvegardé")}).fail(function(a){h("danger",a)}),!1},b.deleteParticipant=function(a,b){return bootbox.confirm("Désinscrire ce joueur ?",function(c){c&&g("ban",a,b).done(function(){h("success","Joueur désinscrit"),$("#inscription"+b).css("display","none"),$("div#inscription"+b).css("display","none")}).fail(function(a){h("danger",a)})}),!1},b.addParticipant=function(a,b){return g("valid",a,b).done(function(){$("div#inscription"+b).css("display","none"),$("#inscription"+b+" button").css("display","none"),h("success","Joueur accepté")}).fail(function(a){h("danger",a)}),!1},b}(tinyMCE),feedbackService=function(){var a={},b=BASE_PATH+"/feedback/",c=function(){return b},d=function(a){return b+a},e=function(a){return b+a+"/vote"},f=function(){return $("#feedbackPopup")},g=function(){return $("#feedbackPopup #feedbackTitle").val()},h=function(){return $("#feedbackPopup #feedbackContent").val()},i=function(){$("#feedbackPopup #feedbackTitle").val(""),tinyMCE.get("feedbackContent").setContent("")},j=function(a){$("#feedbackPopup .msg").html(a)},k=function(a){$("#feedbacksMsg").html(a)},l=function(){return tinyMCE.triggerSave(),$.ajax({type:"POST",url:c(),data:{title:g(),content:h()}})},m=function(a){return $.ajax({type:"DELETE",url:d(a)})},n=function(a,b){return $.ajax({type:"POST",url:e(a),data:{score:b}})};return a.pushFeedback=function(){j(""),l().done(function(){i(),j('<div class="alert alert-success">Merci pour votre contribution !</div>')})},a.close=function(a){bootbox.confirm("Fermer ce feedback ?",function(b){b&&(k(""),m(a).done(function(){k('<div class="alert alert-success">Feedback modifié avec succès</div>'),$("#feedback"+a).css("display","none")}))})},a.voteUp=function(a){k(""),n(a,1).done(function(){k('<div class="alert alert-success">Vote enregistré avec succès</div>'),$("#feedbackVote"+a).css("display","none")}).fail(function(){k('<div class="alert alert-danger">Vote non enregistré</div>')})},a.voteDown=function(a){k(""),n(a,-1).done(function(){k('<div class="alert alert-success">Vote enregistré avec succès</div>'),$("#feedbackVote"+a).css("display","none")}).fail(function(){k('<div class="alert alert-danger">Vote non enregistré</div>')})},a.openModal=function(){f().modal("show")},a}(),forumControllerImpl=function(){function a(){var a=/.*? a lancé .*? et a obtenu : (.*?)Description : .*/i;$(".postContent").each(function(c,d){var e=a.exec(d.innerHTML);null!==e&&(d.innerHTML=d.innerHTML.replace(e[1],b(e[1])))})}var b=function(a){return a.replace(/d([0-9fu]*)(.?) \( (.*?) \)/g,function(a,b,c,d){var e=parseInt(b)<parseInt(d);return'<span class="dice dice_'+b+" "+(e?"dice_exploded":"")+'">'+d+"</span>"})};return{onForumLoaded:a,beautifyDice:b}},forumController=forumControllerImpl();onLoadController.generals.push(forumController.onForumLoaded),$(function(){$(document).on("click",".collapserLink",function(a){a.preventDefault();var b=$(this).children("i");b.hasClass("icon-chevron-sign-down")?b.removeClass("icon-chevron-sign-down").addClass("icon-chevron-sign-up"):b.removeClass("icon-chevron-sign-up").addClass("icon-chevron-sign-down")})}),$(function(){$(document).on("click","a.btn-danger",function(a){a.stopPropagation(),a.preventDefault();var b=$(this).attr("href");bootbox.confirm("L'action demandé est une action dangereuse (Suppression, Quitter une partie, ...). Etes-vous sur ? ",function(a){a&&window.location.replace(b)})})});
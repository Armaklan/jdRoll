{% extends "squelette.html.twig" %}

{% block content %}

<center><h2>Statistiques</h2></center>

<div id="placeholder" class="col-md-10 col-md-offset-1" style="height: 500px;"></div>

<script>


$(function () {

    function gd(year, month, day) {
        return new Date(year, month - 1, day).getTime();
    }

    var data = [
    {% for line in data %}
        [ gd({{line.dat}}),{{line.cpt}}],
    {% endfor %}
    ];

    $.plot($("#placeholder"),
        [{ 
            label: "Messages",
            color: "#0062E3",
            points: { fillColor: "#0062E3", show: true },
            lines: { show: true },
            data: data
        }],
        {
            xaxis: {
                mode: "time",
                timeformat: "%m/%y",
                tickSize: [1, "month"]
            },
            grid: { hoverable: true },
            series: {
                shadowSize: 5
            }
        }
    );


    function showTooltip(x, y, contents) {
        $('<div id="tooltip">' + contents + '</div>').css( {
            position: 'absolute',
            display: 'none',
            top: y + 5,
            left: x + 5,
            border: '1px solid #fdd',
            padding: '2px',
            'background-color': '#fee',
            opacity: 0.80
        }).appendTo("body").fadeIn(200);
    }


    var previousPoint = null;
    $("#placeholder").bind("plothover", function (event, pos, item) {

        if (item) {
            if (previousPoint != item.dataIndex) {
                previousPoint = item.dataIndex;
                
                $("#tooltip").remove();
                var x = new Date(item.datapoint[0] * 1),
                    y = item.datapoint[1];

                var day = x.getDate();
                var month = x.getMonth() + 1;
                var year = x.getFullYear();
                var fulldate = day + "/" + month + "/" + year; 

                showTooltip(item.pageX, item.pageY,
                            item.series.label + " : " + y + " le " + 
                            fulldate);
            }
        }
        else {
            $("#tooltip").remove();
            previousPoint = null;            
        }

    });



});




</script>

{% endblock %}
